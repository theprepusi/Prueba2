<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <title>Prueba 2</title>

  <!--BOOTSTRAP-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

  <!--CSS-->
  <link rel="stylesheet" href="../CSS/Estilo.css">

  <!--CSS JQUERY VALIDATION ENGINE-->
  <link rel="stylesheet" href="../Jquery/jQuery-Validation-Engine-3.0.0/css/validationEngine.jquery.css"
    type="text/css" />

  <!--FONTAWESOME-->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/solid.css">
  <script src="https://kit.fontawesome.com/4a8c9d2193.js" crossorigin="anonymous"></script>


</head>


<body>
  <div class="modal-dialog text-center">
    <H1 style="color:#080808;">Registrate</H1>
    <div class="col-sm-8 main-section">
      <div class="modal-content">
        <div class="col-12 user-img">
          <img src="../Imágenes/user.png">
        </div>
        <form class="col-12" method="post" action="" id="formi">
          <div class="form-group" id="nombre-group">
            <input type="text" class="validate[required] form-control" id="nombre" name="nombre"
              placeholder="Ingrese su nombre" data-errormessage-value-missing="Nombre es obligatorio"
              value=""
              data-prompt-position="bottomRight: 110,-65" />

              <div class="alert alert-danger" role="alert" id="error-user">El usuario debe tener entre 4 y 16 carácteres</div>
              <div class="alert alert-danger" role="alert" id="error-user2">Usuario ya existente</div>
          </div>

          <div class="form-group" id="correo-group">
            <input type="email" class="validate[required,custom[email]] form-control" id="correo" name="correo"
              placeholder="Ingrese su correo" data-errormessage-value-missing="Su correo es obligatorio" value=""
              data-errormessage-custom-error="Ejemplo: ejemplo@gmail.com" data-prompt-position="bottomRight: 110,-30" />

              <div class="alert alert-danger" role="alert" id="error-correo">Correo ya existente</div>
              <div class="alert alert-danger" role="alert" id="error-correo2">Correo inválido</div>
          </div>
          <div class="form-group" id="clave-group">
            <input type="password" class="validate[required] form-control" id="clave"
              name="clave" placeholder="Ingrese su clave" data-errormessage-value-missing="Su clave es obligatoria"
              value=""
              data-prompt-position="bottomRight: 110,-40" />
              <div class="alert alert-danger" role="alert" id="error-password">La contraseña debe tener entre 8 y 16 carácteres</div>
              <div class="alert alert-danger" role="alert" id="error-password2">Cáracteres inválidos</div>
          </div>
          <div class="form-group" id="clave2-group">
            <input type="password" class="validate[required,equals[clave]] form-control" id="clave2" name="clave2"
              placeholder="Confirme su clave" data-errormessage-value-missing="Debe confirmar su clave" value=""
              data-errormessage-pattern-mismatch="Las claves no coinciden" data-prompt-position="bottomRight: 110,-5" />
              <div class="alert alert-danger" role="alert" id="error-conf">!Las claves tienen que ser iguales¡</div>
          </div>
          <!--BOTONES-->
          <button type="submit" class="btn btn-dark" id="validate"><i class="fas fa-sign-in-alt"></i> Validar</button>
          <button type="reset" class="btn btn-danger" id="limpiar"><i class="fab fa-digital-ocean"></i> Limpiar</button>
          <button type="button" class="btn btn-success" id="registro"> Registrarse </button>
        </form>
        <div class="col-12 volver">
          <a href="SigIn.html">Volver</a>
        </div>
      </div>
    </div>

  </div>


  <!--SCRIPTS-->

  <!--JQUERY 3.4.1-->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="../Jquery/jQuery-Validation-Engine-3.0.0/js/jquery.validationEngine.js"></script>
  <script src="../Jquery/jQuery-Validation-Engine-3.0.0/js/languages/jquery.validationEngine-en.js"
    type="text/javascript" charset="utf-8"></script>
  <!--BOOTSTRAP AND POPPER-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
    crossorigin="anonymous"></script>

  <!--JqueryOn-->
  <script type="text/javascript">
    $(document).ready(function () {
      console.log('Jquery funcionando')

      $('#error-user').hide();
      $('#error-password').hide();
      $('#error-password2').hide();
      $('#error-conf').hide();
      $('#error-user2').hide();
      $('#error-correo').hide();
      $('#error-correo2').hide();

      $('#limpiar').click(function(){
        $('#error-user').hide();
        $('#error-password').hide();
        $('#error-password2').hide();
        $('#error-conf').hide();
        $('#error-user2').hide(); 
        $('#error-correo').hide();
        $('#error-correo2').hide(); 
      });
      
      $('#validate').click(function(){
        event.preventDefault();
        var nombre = $('#nombre').val().trim();  

        if(!(nombre.length <=4 && nombre.length>=16)){
          $('error-user').show();
        }else{
          $('error-user').hide();
        }

        console.log('nombre: ', nombre);

        var clave = $('#clave').val();
        var clave2 = $('#clave2').val();

        if (clave !== clave2){
          $('error-conf').show();
        }else{
          $('error-conf').hide();
        }

        if(!(clave.length <=8 && clave.length>=16)){
          $('error-password').show();
        }else{
          $('error-password').hide();
        }

        console.log('clave: ', clave);

      
        var form = new FormData();
        form.append("username", nombre);
        form.append("email", correo);
        form.append("password1", clave);
        form.append("password2", clave2);

        var settings = {
          "url": "http://nriverv.pythonanywhere.com/api/v1/validation/all/",
          "method": "POST",
          "processData": false,
          "mimeType": "multipart/form-data",
          "contentType": false,
          "data": form
        };

        $.ajax(settings).done(function (response) {
          var respuesta_json = JSON.parse(response);

          if(respuesta_json.errorUsername){
            $('#error-user2').show();
          }else{
            $('#error-user2').hide();
          }

          if(respuesta_json.errorEmail){
            $('#error-correo').show();
          }else{
            $('#error-correo').hide();
          }

          if(respuesta_json.errorPassword){
            $('#error-password2').show();
          }else{
            $('#error-passowrd2').hide();
          }

          windows.location = 'home.html';
        }).fail(function(){
             
        });   

        function validarCorreo($correo) {
          var Regcorreo =/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
          return Regcorreo.test( $correo );
        }
        console.log('Validar correo', validarCorreo('Ejemplo: ejemplo@gmail.com'));

        function validarPassword($clave) {
          var Regclave =/^[\-\+]?\d+$/;
          return Regclave.test( $clave );
        }
        console.log('Validar clave', validarPassword('Cáracteres inválidos'));

        $("#formi").validationEngine('attach', { showArrow: false, showArrowOnRadioAndCheckbox: false, showPrompts: true
        });
        
        
      });
    });
  </script>

</body>


</html>